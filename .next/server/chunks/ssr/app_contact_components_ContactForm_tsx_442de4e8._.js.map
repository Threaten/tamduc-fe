{"version":3,"sources":["turbopack:///[project]/app/contact/components/ContactForm.tsx"],"sourcesContent":["\"use client\";\nimport { createMessage, createPatient, getPatient } from \"@/lib/api/queries\";\nimport { useToast } from \"@/app/components/toast\";\nimport React, { useState } from \"react\";\n\ninterface ContactFormState {\n  name: string;\n  email: string;\n  phone: string;\n  subject: string;\n  message: string;\n}\n\nexport default function ContactForm() {\n  const { push } = useToast();\n  const [form, setForm] = useState<ContactFormState>({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    subject: \"\",\n    message: \"\",\n  });\n  const [submitting, setSubmitting] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  // Vietnamese mobile phone regex (accepts +84 or leading 0 followed by valid carrier prefixes)\n  const vnPhoneRegex =\n    /^(?:\\+84|0)(?:3[2-9]|5[25689]|7[06-9]|8[1-689]|9[0-46-9])[0-9]{7}$/;\n\n  const validators: Record<\n    keyof ContactFormState,\n    (val: string) => string | null\n  > = {\n    name: (v) => {\n      const t = v.trim();\n      if (!t) return \"Name is required\";\n      if (t.length <= 5) return \"Name must be at least 6 characters\";\n      return null;\n    },\n    email: (v) => {\n      const t = v.trim();\n      if (!t) return \"Email is required\";\n      // Simple RFC5322-ish pattern (good enough for client-side)\n      const ok = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/.test(t);\n      return ok ? null : \"Invalid email format\";\n    },\n    phone: (v) => {\n      const t = v.replace(/[\\s-]/g, \"\");\n      if (!t) return \"Phone is required\";\n      return vnPhoneRegex.test(t) ? null : \"Invalid Vietnamese phone number\";\n    },\n    subject: (v) => {\n      const t = v.trim();\n      if (!t) return \"Subject is required\";\n      return null;\n    },\n    message: (v) => {\n      const t = v.trim();\n      if (!t) return \"Message is required\";\n      return null;\n    },\n  };\n\n  let patient: string;\n\n  type Patient = {\n    id: string;\n    fullName: string;\n    phone: string;\n    email?: string;\n  };\n\n  const checkIfCustomerExisted = async (phone: string) => {\n    // Placeholder: integrate API call here.\n    const patientData = (await getPatient(`${phone}`)) as {\n      Patients: {\n        docs: Patient[];\n      };\n    };\n\n    if (!patientData.Patients.docs.length) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const newPatient: any = await createPatient(\n        form.name,\n        form.phone,\n        form.email\n      ).catch((error) => {\n        console.error(\"Error creating patient:\", error);\n      });\n\n      patient = newPatient.createPatient.id;\n    } else {\n      patient = patientData.Patients.docs[0].id;\n    }\n    return patient;\n  };\n\n  const validateField = (name: keyof ContactFormState, value: string) => {\n    const fn = validators[name];\n    if (!fn) return;\n    const error = fn(value);\n    setErrors((prev) => {\n      if (error) return { ...prev, [name]: error };\n      // Remove cleared error key; we intentionally ignore the discarded value.\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { [name]: _ignored, ...remaining } = prev;\n      return remaining;\n    });\n  };\n\n  const validateAll = () => {\n    const newErrors: Record<string, string> = {};\n    (Object.keys(form) as (keyof ContactFormState)[]).forEach((k) => {\n      const err = validators[k](form[k]);\n      if (err) newErrors[k] = err;\n    });\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const { name, value } = e.target;\n    setForm((prev) => ({ ...prev, [name]: value }));\n    validateField(name as keyof ContactFormState, value);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (submitting) return;\n    // Final validation pass\n    if (!validateAll()) return;\n    setSubmitting(true);\n    try {\n      await checkIfCustomerExisted(form.phone);\n      await createMessage(patient, form.subject, form.message);\n      setSubmitted(true);\n      push(\"Message sent successfully\", \"success\");\n    } catch (err) {\n      console.error(err);\n      push(\"Failed to send message\", \"error\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (submitted) {\n    return (\n      <div className=\"rounded-2xl border border-black/10 dark:border-white/10 p-6 text-sm\">\n        <p className=\"font-medium\">Thank you! Your message has been sent.</p>\n        <button\n          className=\"mt-4 rounded-full px-4 py-2 border border-black/10 dark:border-white/10 text-xs\"\n          onClick={() => {\n            setSubmitted(false);\n            setForm({\n              name: \"\",\n              email: \"\",\n              phone: \"\",\n              subject: \"\",\n              message: \"\",\n            });\n            setErrors({});\n          }}\n          type=\"button\"\n        >\n          Send another message\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <form\n      onSubmit={handleSubmit}\n      className=\"rounded-2xl border border-black/10 dark:border-white/10 p-6 space-y-4\"\n    >\n      <div>\n        <label className=\"block text-sm mb-1\" htmlFor=\"contact-name\">\n          Name\n        </label>\n        <input\n          id=\"contact-name\"\n          name=\"name\"\n          value={form.name}\n          onChange={handleChange}\n          className=\"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm\"\n          placeholder=\"Your name\"\n          required\n          aria-invalid={!!errors.name}\n        />\n        {errors.name && (\n          <p className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n            {errors.name}\n          </p>\n        )}\n      </div>\n      <div>\n        <label className=\"block text-sm mb-1\" htmlFor=\"contact-email\">\n          Email\n        </label>\n        <input\n          id=\"contact-email\"\n          type=\"email\"\n          name=\"email\"\n          value={form.email}\n          onChange={handleChange}\n          className=\"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm\"\n          placeholder=\"you@example.com\"\n          required\n          aria-invalid={!!errors.email}\n        />\n        {errors.email && (\n          <p className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n            {errors.email}\n          </p>\n        )}\n      </div>\n      <div>\n        <label className=\"block text-sm mb-1\" htmlFor=\"contact-phone\">\n          Phone\n        </label>\n        <input\n          id=\"contact-phone\"\n          name=\"phone\"\n          value={form.phone}\n          onChange={handleChange}\n          className=\"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm\"\n          placeholder=\"0xx… or +84…\"\n          required\n          aria-invalid={!!errors.phone}\n        />\n        {errors.phone && (\n          <p className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n            {errors.phone}\n          </p>\n        )}\n      </div>\n      <div>\n        <label className=\"block text-sm mb-1\" htmlFor=\"contact-subject\">\n          Subject\n        </label>\n        <input\n          id=\"contact-subject\"\n          name=\"subject\"\n          value={form.subject}\n          onChange={handleChange}\n          className=\"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm\"\n          placeholder=\"Subject\"\n          required\n          aria-invalid={!!errors.subject}\n        />\n        {errors.subject && (\n          <p className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n            {errors.subject}\n          </p>\n        )}\n      </div>\n      <div>\n        <label className=\"block text-sm mb-1\" htmlFor=\"contact-message\">\n          Message\n        </label>\n        <textarea\n          id=\"contact-message\"\n          name=\"message\"\n          value={form.message}\n          onChange={handleChange}\n          className=\"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm\"\n          rows={4}\n          placeholder=\"How can we help?\"\n          required\n          aria-invalid={!!errors.message}\n        />\n        {errors.message && (\n          <p className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n            {errors.message}\n          </p>\n        )}\n      </div>\n      <button\n        disabled={submitting}\n        className=\"rounded-full px-5 py-2 text-sm font-medium border border-black/10 dark:border-white/10 disabled:opacity-50\"\n      >\n        {submitting ? \"Sending...\" : \"Send\"}\n      </button>\n    </form>\n  );\n}\n"],"names":[],"mappings":"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"}