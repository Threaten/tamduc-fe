module.exports=[55871,a=>{"use strict";a.s(["ReservationForm",()=>i]);var b=a.i(87924),c=a.i(19955),d=a.i(18952),e=a.i(72131);let f=[{value:"",label:"Select gender (optional)"},{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}],g=/^(?:\+?84|0)(3|5|7|8|9)\d{8}$/;function h(a,b){if(!a||!b)return null;let c=a.split("-").map(Number),d=b.split(":").map(Number);if(3!==c.length||d.length<2)return null;let[e,f,g]=c,[h,i]=d;if([e,f,g,h,i].some(a=>Number.isNaN(a))||f<1||f>12||g<1||g>31||h<0||h>23||i<0||i>59)return null;let j=new Date(e,f-1,g,h,i,0,0),k=a=>a.toString().padStart(2,"0");return{date:j,isoLocal:`${e}-${k(f)}-${k(g)}T${k(h)}:${k(i)}:00`}}function i(a){let i,j=a.departmentsProp,[k,l]=(0,e.useState)({name:"",phone:"",email:"",dob:"",gender:"",date:"",time:"",symptoms:"",department:""}),[m,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)({}),[q,r]=(0,e.useState)(!1),s=(0,e.useMemo)(()=>{let a=new Date,b=a=>a.toString().padStart(2,"0");return`${a.getFullYear()}-${b(a.getMonth()+1)}-${b(a.getDate())}`},[]),t=(0,e.useMemo)(()=>{let a=new Date;a.setDate(a.getDate()+90);let b=a=>a.toString().padStart(2,"0");return`${a.getFullYear()}-${b(a.getMonth()+1)}-${b(a.getDate())}`},[]),{push:u}=(0,d.useToast)(),v=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/,w={name:a=>{let b=a.trim();return b?b.length<2?"Name must be at least 2 characters":null:"Full name is required"},phone:a=>{let b=a.trim();return b?g.test(b)?null:"Invalid Vietnamese phone":"Phone is required"},email:a=>{let b=a.trim();return b?v.test(b)?null:"Invalid email":""},dob:a=>a?a>=s?"DOB must be before today":null:"Date of birth is required",gender:()=>null,date:a=>a?a<s?"Date must be today or later":a>t?"Date cannot be more than 90 days out":null:"Date is required",time:a=>a?null:"Time is required",symptoms:a=>a.trim()?null:"Symptoms are required",department:a=>a?null:"Department is required"},x=(a,b,c)=>{let d=w[a];if(!d)return;let e=d(b,c);p(b=>{if(e)return{...b,[a]:e};let c={...b};return delete c[a],c})},y=a=>{let b={};if(Object.keys(a).forEach(c=>{let d=w[c](a[c],a);d&&(b[c]=d)}),!b.date&&!b.time&&a.date&&a.time){let c=h(a.date,a.time);if(c){let a=new Date(new Date().getTime()+18e5);c.date.getTime()<=a.getTime()&&(b.time="Appointment must be at least 30 minutes from now");let d=h(t,"23:59");d&&c.date.getTime()>d.date.getTime()&&(b.date="Appointment beyond allowed horizon")}else b.time="Invalid date/time"}return p(b),0===Object.keys(b).length},z=async a=>{let b=await (0,c.getPatient)(`${a}`);return i=b.Patients.docs.length?b.Patients.docs[0].id:(await (0,c.createPatient)(k.name,k.phone,k.email,k.gender,k.dob).catch(a=>{console.error("Error creating patient:",a)})).createPatient.id};async function A(a){if(a.preventDefault(),m||!y(k))return;let b=h(k.date,k.time);if(!b)return void p(a=>({...a,time:a.time||"Invalid date/time"}));n(!0),await z(k.phone);try{await (0,c.createReservation)(i,b.isoLocal,k.symptoms,k.department),r(!0),u("Reservation submitted","success")}catch(a){console.error(a),u("Failed to submit reservation","error")}finally{n(!1)}}return q?(0,b.jsx)("div",{className:"mt-6 rounded-2xl border border-black/10 dark:border-white/10 p-6",children:(0,b.jsx)("p",{className:"text-sm",children:"Thank you, we’ve received your reservation."})}):(0,b.jsxs)("form",{onSubmit:A,className:"mt-6 rounded-2xl border border-black/10 dark:border-white/10 p-6 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Full Name"}),(0,b.jsx)("input",{className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.name,onChange:a=>{let b=a.target.value;l(a=>({...a,name:b})),x("name",b,{...k,name:b})},placeholder:"Nguyen Van A",required:!0,"aria-invalid":!!o.name}),o.name&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Phone (Vietnam)"}),(0,b.jsx)("input",{className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.phone,onChange:a=>{let b=a.target.value;l(a=>({...a,phone:b})),x("phone",b,{...k,phone:b})},placeholder:"0xxxxxxxxx or +84xxxxxxxxx",required:!0,"aria-invalid":!!o.phone}),o.phone&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.phone})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Email"}),(0,b.jsx)("input",{type:"email",className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.email,onChange:a=>{let b=a.target.value;l(a=>({...a,email:b})),x("email",b,{...k,email:b})},placeholder:"you@example.com","aria-invalid":!!o.email}),o.email&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.email})]}),(0,b.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Date of Birth"}),(0,b.jsx)("input",{type:"date",max:s,className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.dob,onChange:a=>{let b=a.target.value;l(a=>({...a,dob:b})),x("dob",b,{...k,dob:b})},required:!0,"aria-invalid":!!o.dob}),o.dob&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.dob})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Gender"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("select",{className:"w-full appearance-none rounded-md border border-black/10 dark:border-white/10 bg-transparent backdrop-blur px-3 py-2 pr-8 text-sm leading-tight focus:outline-none focus:ring-2 focus:ring-black/20 dark:focus:ring-white/20 transition-colors",value:k.gender,onChange:a=>l({...k,gender:a.target.value}),children:f.map(a=>(0,b.jsx)("option",{value:a.value,className:"bg-white dark:bg-black text-inherit",children:a.label},a.value))}),(0,b.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-2 flex items-center text-xs opacity-60",children:"▾"})]})]})]}),(0,b.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Date"}),(0,b.jsx)("input",{type:"date",min:s,max:t,className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.date,onChange:a=>{let b=a.target.value;l(a=>({...a,date:b})),x("date",b,{...k,date:b}),k.time&&y({...k,date:b})},required:!0,"aria-invalid":!!o.date}),o.date&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.date})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Time"}),(0,b.jsx)("input",{type:"time",className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.time,onChange:a=>{let b=a.target.value;l(a=>({...a,time:b})),x("time",b,{...k,time:b}),k.date&&y({...k,time:b})},required:!0,"aria-invalid":!!o.time}),o.time&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.time})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Symptoms"}),(0,b.jsx)("textarea",{rows:3,className:"w-full rounded-md border border-black/10 dark:border-white/10 bg-transparent px-3 py-2 text-sm",value:k.symptoms,onChange:a=>{let b=a.target.value;l(a=>({...a,symptoms:b})),x("symptoms",b,{...k,symptoms:b})},placeholder:"Describe your symptoms",required:!0,"aria-invalid":!!o.symptoms}),o.symptoms&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.symptoms})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm mb-1",children:"Department"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("select",{className:"w-full appearance-none rounded-md border border-black/10 dark:border-white/10 bg-transparent backdrop-blur px-3 py-2 pr-8 text-sm leading-tight focus:outline-none focus:ring-2 focus:ring-black/20 dark:focus:ring-white/20 transition-colors",value:k.department,onChange:a=>{let b=a.target.value;l(a=>({...a,department:b})),x("department",b,{...k,department:b})},required:!0,"aria-invalid":!!o.department,children:[(0,b.jsx)("option",{value:"",disabled:!0,children:"Select your option"},"default"),j.map(a=>(0,b.jsx)("option",{value:a.id,className:"bg-white dark:bg-black text-inherit",children:a.title},a.slug))]}),(0,b.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-2 flex items-center text-xs opacity-60",children:"▾"})]}),o.department&&(0,b.jsx)("p",{className:"text-red-500 text-xs mt-1",children:o.department})]}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)("button",{disabled:m,className:"rounded-full px-5 py-2 text-sm font-medium border border-black/10 dark:border-white/10 disabled:opacity-50",children:m?"Submitting...":"Reserve"})})]})}}];

//# sourceMappingURL=app_reservation_components_reservation-form_tsx_14aa5ce2._.js.map